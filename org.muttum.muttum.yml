---
# SPDX-FileCopyrightText: 2025 Adrien Dorsaz
# SPDX-License-Identifier: GPL-3.0-or-later

id: org.muttum.muttum
runtime: org.gnome.Platform
runtime-version: "48"
sdk: org.gnome.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
command: muttum
finish-args:
  - --device=dri
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
build-options:
  append-path: /usr/lib/sdk/rust-stable/bin
cleanup:
  - /man
modules:
  - name: ispell
    buildsystem: simple
    build-commands:
      - |
        cat <<- EOF >local.h
        #ifndef LOCAL_H_INCLUDED
        #define LOCAL_H_INCLUDED

        #define MINIMENU
        #define USG
        #define GENERATE_LIBRARY_PROTOS
        #define	HAS_RENAME
        /* Not all linuxes have yacc, but all have bison */
        #define YACC "bison -y"

        #define TERMLIB       "-ltinfo"

        #define BINDIR	"/app/bin"
        #define LIBDIR	"/app/lib"
        #define MAN1DIR	"/app/man/man1"
        #define	MAN45DIR "/app/man/man5"
        #define	MAN45EXT ".5"

        #endif /* LOCAL_H_INCLUDED */
        EOF
      - make all
      - make install
    sources:
      - type: archive
        url: https://www.cs.hmc.edu/~geoff/tars/ispell-3.4.06.tar.gz
        sha256: 17c91633d4c8075acc503163a16463fc54ab1c7453280ad39cd3db75c783eba6
        strip-components: 1
  - name: english-words
    buildsystem: simple
    build-commands:
      - mkdir -p /app/share/org.muttum.muttum
      - >-
        cat final/english-words.* final/american-words.*
        | sort -u
        | iconv -f iso-8859-1 -t utf-8 -o /app/share/org.muttum.muttum/en_US
      - >-
        cat final/english-words.* final/australian-words.*
        | sort -u
        | iconv -f iso-8859-1 -t utf-8 -o /app/share/org.muttum.muttum/en_AU
      - >-
        cat final/english-words.* final/british-words.*
        | sort -u
        | iconv -f iso-8859-1 -t utf-8 -o /app/share/org.muttum.muttum/en_GB
      - >-
        cat final/english-words.* final/canadian-words.*
        | sort -u
        | iconv -f iso-8859-1 -t utf-8 -o /app/share/org.muttum.muttum/en_CA
      - cp Copyright /app/share/org.muttum.muttum/en.license
    sources:
      - type: archive
        url: http://downloads.sourceforge.net/wordlist/scowl-2020.12.07.tar.gz
        sha256: 5587667caa20c4891390c2d42dbb4d5c4c3f41bee77af1457ece3ba23fb859cc
        strip-components: 1
  - name: german-words
    buildsystem: simple
    build-commands:
      - mkdir -p /app/share/org.muttum.muttum
      - make isowordlist-de_AT
      - >-
        iconv -f iso-8859-1 -t utf-8 < isowordlist-de_AT
        > /app/share/org.muttum.muttum/de_AT
      - make isowordlist-de_CH
      - >-
        iconv -f iso-8859-1 -t utf-8 < isowordlist-de_CH
        > /app/share/org.muttum.muttum/de_CH
      - make isowordlist-de_DE
      - >-
        iconv -f iso-8859-1 -t utf-8 < isowordlist-de_DE
        > /app/share/org.muttum.muttum/de_DE
      - cp Documentation/Copyright /app/share/org.muttum.muttum/de.license
    sources:
      - type: archive
        url: https://j3e.de/ispell/igerman98/dict/igerman98-20161207.tar.bz2
        sha256: 17296f03c5fea62d76ecc530ebe80f6adc430278f58d472dc1842d71612960a8
        strip-components: 1
  - name: french-words
    buildsystem: simple
    build-commands:
      - mkdir -p /app/share/org.muttum.muttum
      - cp french /app/share/org.muttum.muttum/fr
      - cp LICENSES/GPL-3.0-or-later.txt /app/share/org.muttum.muttum/fr.license
    sources:
      - type: git
        url: https://salsa.debian.org/gpernot/wfrench.git
        commit: d69373cc8e4b0f0629378856c37a5df6f8c3b155
  - name: muttum.toml
    buildsystem: simple
    build-commands:
      - mkdir -p /app/etc/xdg/org.muttum.muttum
      - |
        cat <<- EOF >/app/etc/xdg/org.muttum.muttum/muttum.toml
        [[dictionaries]]
        locales = ["de_AT", "de_CH", "de_DE"]
        uris = [
          "/app/share/org.muttum.muttum/de_AT",
          "/app/share/org.muttum.muttum/de_CH",
          "/app/share/org.muttum.muttum/de_DE",
        ]
        project_uri = "https://j3e.de/ispell/igerman98/"
        repository_uri = "https://j3e.de/ispell/igerman98/dict/"
        credits = [
          "Daniel NABER",
          "Werner LEMBERG",
          "László NÉMETH",
          "Jan SCHREIBER",
          "Roland ROSENFELD",
          "Till BERGER",
          "Franz Michael BAUMANN",
        ]
        license = "GPL-3.0-only"
        version = "20161207"
        definition_url_template = "https://de.wiktionary.org/wiki/{}"
        min_word_length = 5
        max_word_length = 8
        number_of_attempts = 6
        alphabet = "latin"

        [[dictionaries]]
        locales = ["en_AU", "en_CA", "en_GB", "en_US"]
        uris = [
          "/app/share/org.muttum.muttum/en_AU",
          "/app/share/org.muttum.muttum/en_CA",
          "/app/share/org.muttum.muttum/en_GB",
          "/app/share/org.muttum.muttum/en_US",
        ]
        project_uri = "http://wordlist.aspell.net/"
        repository_uri = "http://wordlist.aspell.net/"
        credits = [
          "Kevin Atkinson <kevina@gnu.org>",
          "Alan Beale <biljir@pobox.com>",
        ]
        license = "MIT-like"
        version = "2020.12.07"
        definition_url_template = "https://en.wiktionary.org/wiki/{}"
        min_word_length = 5
        max_word_length = 8
        number_of_attempts = 6
        alphabet = "latin"

        [[dictionaries]]
        locales = ["fr"]
        uris = ["/app/share/org.muttum.muttum/fr"]
        project_uri = "https://salsa.debian.org/gpernot/wfrench.git"
        repository_uri = "https://salsa.debian.org/gpernot/wfrench.git"
        credits = [
          "guillaume pernot <gpernot@praksys.org>",
          "Paul Leyland <pcl@ox.ac.uk>",
          "Nicolas Sabouret <nico@debian.org>",
          "Francois Marier <francois@debian.org>",
        ]
        license = "GPL-3.0-or-later"
        version = "trixie"
        definition_url_template = "https://fr.wiktionary.org/wiki/{}"
        min_word_length = 5
        max_word_length = 8
        number_of_attempts = 6
        alphabet = "latin"
        EOF
  - name: muttum
    buildsystem: meson
    build-options:
      env:
        CARGO_NET_OFFLINE: 'true'
    config-opts:
      - -Dbuildtype=release
    sources:
      - type: archive
        url: "https://gitlab.adorsaz.ch/muttum/muttum/-/releases/\
              25.06.3/downloads/dist/muttum-25.06.3.tar.xz"
        sha256: 79cf2583da9911a8558d9feccbb755aa001b0242f0dc3ab09efc22ea43ed5121
